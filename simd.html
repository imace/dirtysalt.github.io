<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
lang="en" xml:lang="en">
<head><!-- <meta name="baidu-site-verification" content="707024a76f8f40b549f07f478abab237"/> -->
<title>simd</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2013-10-14 12:18:21 CST"/>
<meta name="author" content="dirtysalt"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style><link rel="stylesheet" type="text/css" href="./css/site.css" />

</head>
<body><!-- <div id="bdshare" class="bdshare_t bds_tools_32 get-codes-bdshare"><a class="bds_tsina"></a><span class="bds_more"></span><a class="shareCount"></a></div> --><!-- Place this tag where you want the +1 button to render --><g:plusone annotation="inline"></g:plusone>
<div id="content">

<h1 class="title">simd</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 simd </a>
<ul>
<li><a href="#sec-1.1">1.1 指令集 </a>
<ul>
<li><a href="#sec-1.1.1">1.1.1 MMX </a></li>
<li><a href="#sec-1.1.2">1.1.2 SSE. </a></li>
<li><a href="#sec-1.1.3">1.1.3 SSE2 </a></li>
<li><a href="#sec-1.1.4">1.1.4 SSE3 </a></li>
<li><a href="#sec-1.1.5">1.1.5 SSSE3 </a></li>
<li><a href="#sec-1.1.6">1.1.6 SSE4 </a></li>
<li><a href="#sec-1.1.7">1.1.7 检测代码 </a></li>
</ul>
</li>
<li><a href="#sec-1.2">1.2 基本概念 </a>
<ul>
<li><a href="#sec-1.2.1">1.2.1 %mm寄存器 </a></li>
<li><a href="#sec-1.2.2">1.2.2 %xmm寄存器 </a></li>
<li><a href="#sec-1.2.3">1.2.3 %mxcsr寄存器 </a></li>
<li><a href="#sec-1.2.4">1.2.4 Saturation &amp; Wraparound </a></li>
<li><a href="#sec-1.2.5">1.2.5 General Purpose Register(GPR) </a></li>
<li><a href="#sec-1.2.6">1.2.6 X87 FPU </a></li>
<li><a href="#sec-1.2.7">1.2.7 Packed &amp; Scalar Instructions </a></li>
<li><a href="#sec-1.2.8">1.2.8 Temporal &amp; NonTemporal Data </a></li>
<li><a href="#sec-1.2.9">1.2.9 Alignment </a></li>
<li><a href="#sec-1.2.10">1.2.10 Asymmetric &amp; Horizontal Processing </a></li>
<li><a href="#sec-1.2.11">1.2.11 Zero Fill &amp; Truncated </a></li>
</ul>
</li>
<li><a href="#sec-1.3">1.3 指令 </a>
<ul>
<li><a href="#sec-1.3.1">1.3.1 Data Transfer Instructions </a>
<ul>
<li><a href="#sec-1.3.1.1">1.3.1.1 Move Mask Instructions </a></li>
<li><a href="#sec-1.3.1.2">1.3.1.2 Move Integer Instructions </a></li>
<li><a href="#sec-1.3.1.3">1.3.1.3 Move Float Instructions </a></li>
<li><a href="#sec-1.3.1.4">1.3.1.4 Move Double Instructions </a></li>
<li><a href="#sec-1.3.1.5">1.3.1.5 Move Duplication Instructions </a></li>
<li><a href="#sec-1.3.1.6">1.3.1.6 Move NonTemporal Instructions </a></li>
</ul>
</li>
<li><a href="#sec-1.3.2">1.3.2 Arithmetic Instructions </a>
<ul>
<li><a href="#sec-1.3.2.1">1.3.2.1 ADD Instructions </a></li>
<li><a href="#sec-1.3.2.2">1.3.2.2 SUB Instructions </a></li>
<li><a href="#sec-1.3.2.3">1.3.2.3 MUL Instructions </a></li>
<li><a href="#sec-1.3.2.4">1.3.2.4 DIV Instructions </a></li>
<li><a href="#sec-1.3.2.5">1.3.2.5 M?X Instructions </a></li>
<li><a href="#sec-1.3.2.6">1.3.2.6 Math Instructions </a></li>
</ul>
</li>
<li><a href="#sec-1.3.3">1.3.3 Comparison Instructions </a></li>
<li><a href="#sec-1.3.4">1.3.4 Conversion Instructions </a></li>
<li><a href="#sec-1.3.5">1.3.5 Insert &amp; Unpack Instructions </a></li>
<li><a href="#sec-1.3.6">1.3.6 Logical Instructions </a></li>
<li><a href="#sec-1.3.7">1.3.7 Shift Instructions </a></li>
<li><a href="#sec-1.3.8">1.3.8 Shuffle Instructions </a></li>
<li><a href="#sec-1.3.9">1.3.9 Blending Instructions </a></li>
<li><a href="#sec-1.3.10">1.3.10 String Instructions </a></li>
<li><a href="#sec-1.3.11">1.3.11 MISC Instructions </a>
<ul>
<li><a href="#sec-1.3.11.1">1.3.11.1 Cache Control Instructions </a></li>
<li><a href="#sec-1.3.11.2">1.3.11.2 Prefetch Instructions </a></li>
<li><a href="#sec-1.3.11.3">1.3.11.3 Memory Ordering Instructions </a></li>
<li><a href="#sec-1.3.11.4">1.3.11.4 X87 FPU Instructions </a></li>
<li><a href="#sec-1.3.11.5">1.3.11.5 Thread Sync Instructions </a></li>
<li><a href="#sec-1.3.11.6">1.3.11.6 其他 </a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> simd </h2>
<div class="outline-text-2" id="text-1">


<p>
从Pentium II和Pentium MMX处理器系列开始,芯片开始支持SIMD操作.
SIMD全称是Single Instruction Multiple Data,即单指令多数据,
可以在一个周期内操作多个数据.
</p>

</div>

<div id="outline-container-1.1" class="outline-3">
<h3 id="sec-1.1"><span class="section-number-3">1.1</span> 指令集 </h3>
<div class="outline-text-3" id="text-1.1">


</div>

<div id="outline-container-1.1.1" class="outline-4">
<h4 id="sec-1.1.1"><span class="section-number-4">1.1.1</span> MMX </h4>
<div class="outline-text-4" id="text-1.1.1">

<ul>
<li>
Multimedia Extensions.[PII &amp; PMMX]
</li>
<li>
(CPUID.01H:EDX.MMX[bit 23]=1)

</li>
</ul>
</div>

</div>

<div id="outline-container-1.1.2" class="outline-4">
<h4 id="sec-1.1.2"><span class="section-number-4">1.1.2</span> SSE. </h4>
<div class="outline-text-4" id="text-1.1.2">

<ul>
<li>
Streaming SIMD Extensions.[PIII]
</li>
<li>
(CPUID.01H:EDX.SSE[bit 25]=1)

</li>
</ul>
</div>

</div>

<div id="outline-container-1.1.3" class="outline-4">
<h4 id="sec-1.1.3"><span class="section-number-4">1.1.3</span> SSE2 </h4>
<div class="outline-text-4" id="text-1.1.3">

<ul>
<li>
Streaming SIMD Extensions2.[P4 &amp; Xeon]
</li>
<li>
(CPUID.01H:EDX.SSE2[bit 26]=1)

</li>
</ul>
</div>

</div>

<div id="outline-container-1.1.4" class="outline-4">
<h4 id="sec-1.1.4"><span class="section-number-4">1.1.4</span> SSE3 </h4>
<div class="outline-text-4" id="text-1.1.4">

<ul>
<li>
Streaming SIMD Extensions3.[P4(HT)]
</li>
<li>
(CPUID.01H:ECX.SSE3[bit 0]=1)

</li>
</ul>
</div>

</div>

<div id="outline-container-1.1.5" class="outline-4">
<h4 id="sec-1.1.5"><span class="section-number-4">1.1.5</span> SSSE3 </h4>
<div class="outline-text-4" id="text-1.1.5">

<ul>
<li>
Supplemental Stream SIMD Extensions3.[Xeon(5100) &amp; Core2]
</li>
<li>
(CPUID.01H:ECX.SSSE3[bit 9]=1)

</li>
</ul>
</div>

</div>

<div id="outline-container-1.1.6" class="outline-4">
<h4 id="sec-1.1.6"><span class="section-number-4">1.1.6</span> SSE4 </h4>
<div class="outline-text-4" id="text-1.1.6">

<ul>
<li>
Streaming SIMD Extensions4.[Xeon(5400) &amp; Core2Ex(QX9650)]
</li>
<li>
SSE4.1.(CPUID.01H:ECX.SSE4<sub>1[bit</sub> 19]=1)
</li>
<li>
SSE4.2.(CPUID.01H:ECX.SSE4<sub>2[bit</sub> 20]=1)

</li>
</ul>
</div>

</div>

<div id="outline-container-1.1.7" class="outline-4">
<h4 id="sec-1.1.7"><span class="section-number-4">1.1.7</span> 检测代码 </h4>
<div class="outline-text-4" id="text-1.1.7">




<pre class="src src-C++">/***************************************************************************
 *
 * Copyright (c) Baidu.com, Inc. All Rights Reserved
 *
 **************************************************************************/


/**
 * @file   detect.c
 * @author zhangyan04(@baidu.com)
 * @brief
 *
 */

#include &lt;stdio.h&gt;
int check_support_mmx(){
    int res=0;
    __asm__ __volatile__(
        <span class="org-string">"movl $1,%%eax\n\t"</span>
        <span class="org-string">"cpuid\n\t"</span>
        <span class="org-string">"test $0x800000,%%edx\n\t"</span>
        <span class="org-string">"jz 1f\n\t"</span>
        <span class="org-string">"movl $1,%0\n\t"</span>
        <span class="org-string">"1:\n\t"</span>
        :<span class="org-string">"=m"</span>(res)
        ::<span class="org-string">"eax"</span>,<span class="org-string">"edx"</span>);
    return res;
}
int check_support_sse(){
    int res=0;
    __asm__ __volatile__(
        <span class="org-string">"movl $1,%%eax\n\t"</span>
        <span class="org-string">"cpuid\n\t"</span>
        <span class="org-string">"test $0x02000000,%%edx\n\t"</span>
        <span class="org-string">"jz 1f\n\t"</span>
        <span class="org-string">"movl $1,%0\n\t"</span>
        <span class="org-string">"1:\n\t"</span>
        :<span class="org-string">"=m"</span>(res)
        ::<span class="org-string">"eax"</span>,<span class="org-string">"edx"</span>);
    return res;
}
int check_support_sse2(){
    int res=0;
    __asm__ __volatile__(
        <span class="org-string">"movl $1,%%eax\n\t"</span>
        <span class="org-string">"cpuid\n\t"</span>
        <span class="org-string">"test $0x04000000,%%edx\n\t"</span>
        <span class="org-string">"jz 1f\n\t"</span>
        <span class="org-string">"movl $1,%0\n\t"</span>
        <span class="org-string">"1:\n\t"</span>
        :<span class="org-string">"=m"</span>(res)
        ::<span class="org-string">"eax"</span>,<span class="org-string">"edx"</span>);
    return res;
}
int check_support_sse3(){
    int res=0;
    __asm__ __volatile__(
        <span class="org-string">"movl $1,%%eax\n\t"</span>
        <span class="org-string">"cpuid\n\t"</span>
        <span class="org-string">"test $0x1,%%ecx\n\t"</span>
        <span class="org-string">"jz 1f\n\t"</span>
        <span class="org-string">"movl $1,%0\n\t"</span>
        <span class="org-string">"1:\n\t"</span>
        :<span class="org-string">"=m"</span>(res)
        ::<span class="org-string">"eax"</span>,<span class="org-string">"edx"</span>);
    return res;
}
int check_support_ssse3(){
    int res=0;
    __asm__ __volatile__(
        <span class="org-string">"movl $1,%%eax\n\t"</span>
        <span class="org-string">"cpuid\n\t"</span>
        <span class="org-string">"test $0x0200,%%ecx\n\t"</span>
        <span class="org-string">"jz 1f\n\t"</span>
        <span class="org-string">"movl $1,%0\n\t"</span>
        <span class="org-string">"1:\n\t"</span>
        :<span class="org-string">"=m"</span>(res)
        ::<span class="org-string">"eax"</span>,<span class="org-string">"edx"</span>);
    return res;
}
int check_support_sse4_1(){
    int res=0;
    __asm__ __volatile__(
        <span class="org-string">"movl $1,%%eax\n\t"</span>
        <span class="org-string">"cpuid\n\t"</span>
        <span class="org-string">"test $0x80000,%%ecx\n\t"</span>
        <span class="org-string">"jz 1f\n\t"</span>
        <span class="org-string">"movl $1,%0\n\t"</span>
        <span class="org-string">"1:\n\t"</span>
        :<span class="org-string">"=m"</span>(res)
        ::<span class="org-string">"eax"</span>,<span class="org-string">"edx"</span>);
    return res;
}
int check_support_sse4_2(){
    int res=0;
    __asm__ __volatile__(
        <span class="org-string">"movl $1,%%eax\n\t"</span>
        <span class="org-string">"cpuid\n\t"</span>
        <span class="org-string">"test $0x0100000,%%ecx\n\t"</span>
        <span class="org-string">"jz 1f\n\t"</span>
        <span class="org-string">"movl $1,%0\n\t"</span>
        <span class="org-string">"1:\n\t"</span>
        :<span class="org-string">"=m"</span>(res)
        ::<span class="org-string">"eax"</span>,<span class="org-string">"edx"</span>);
    return res;
}
int main(){
    printf(<span class="org-string">"MMX[%s]\n"</span>,check_support_mmx()?<span class="org-string">"OK"</span>:<span class="org-string">"FAILED"</span>);
    printf(<span class="org-string">"SSE[%s]\n"</span>,check_support_sse()?<span class="org-string">"OK"</span>:<span class="org-string">"FAILED"</span>);
    printf(<span class="org-string">"SSE2[%s]\n"</span>,check_support_sse2()?<span class="org-string">"OK"</span>:<span class="org-string">"FAILED"</span>);
    printf(<span class="org-string">"SSE3[%s]\n"</span>,check_support_sse3()?<span class="org-string">"OK"</span>:<span class="org-string">"FAILED"</span>);
    printf(<span class="org-string">"SSSE3[%s]\n"</span>,check_support_ssse3()?<span class="org-string">"OK"</span>:<span class="org-string">"FAILED"</span>);
    printf(<span class="org-string">"SSE4.1[%s]\n"</span>,check_support_sse4_1()?<span class="org-string">"OK"</span>:<span class="org-string">"FAILED"</span>);
    printf(<span class="org-string">"SSE4.2[%s]\n"</span>,check_support_sse4_2()?<span class="org-string">"OK"</span>:<span class="org-string">"FAILED"</span>);
    return 0;
}

</pre>




</div>
</div>

</div>

<div id="outline-container-1.2" class="outline-3">
<h3 id="sec-1.2"><span class="section-number-3">1.2</span> 基本概念 </h3>
<div class="outline-text-3" id="text-1.2">


</div>

<div id="outline-container-1.2.1" class="outline-4">
<h4 id="sec-1.2.1"><span class="section-number-4">1.2.1</span> %mm寄存器 </h4>
<div class="outline-text-4" id="text-1.2.1">

<p>%mm寄存器是64bit,共有8个%mm寄存器.需要注意的是,%mm0-%mm7是X87 FPU寄存器的alias,
分别对应%r0-%r7.所以对%mm0-%mm7的操作会覆盖X87 FPU的内容.使用%mm寄存器的时候,
效果是这样的.
</p><ol>
<li>
TOS(Top Of Stack)会被置为0,也就是FPU registers的顶部会置0.
</li>
<li>
整个FPU tag word会被置为valid(0x0).如果后续想使用的话,需要使用EMMS指令.
</li>
<li>
FPU register有80位,但是%mm寄存器只是用了64位,因此其余位填充(0xff).

</li>
</ol>

<p>因此如果在使用%mm寄存器之后,想使用FPU指令的话,那么应该
</p><ol>
<li>
fsave/fxsave保存FPU状态.
</li>
<li>
执行EMMS指令.
</li>
<li>
可选地使用frstore/fxstore载入之前FPU状态.
</li>
<li>
执行FPU指令.

</li>
</ol>

<p>如果使用FPU指令之后,想切换回%mm寄存器的话.
</p><ol>
<li>
fsave/fxsave保存FPU状态.
</li>
<li>
可选地使用frstore/fxrstore载入之前FPU状态.
</li>
<li>
操作%mm寄存器.

</li>
</ol>

<p>EMMS指令会清除MMX的状态,将FPU tag word进行清空,表示所有的FPU registers都已经清空.
我们必须在执行完成MMX指令之后,如果之后需要使用FPU registers的话,那么需要执行这个指令.
</p>
</div>

</div>

<div id="outline-container-1.2.2" class="outline-4">
<h4 id="sec-1.2.2"><span class="section-number-4">1.2.2</span> %xmm寄存器 </h4>
<div class="outline-text-4" id="text-1.2.2">

<p>%xmm寄存器是128bit.
Intel64架构下允许访问16个%xmm寄存器.
IA-32架构下只允许访问8个%xmm寄存器.
</p>
</div>

</div>

<div id="outline-container-1.2.3" class="outline-4">
<h4 id="sec-1.2.3"><span class="section-number-4">1.2.3</span> %mxcsr寄存器 </h4>
<div class="outline-text-4" id="text-1.2.3">

<p>%mxcsr是32bit.%mxcsr寄存器是在SSE指令集引入的,用来控制作用在%xmm寄存器操作的行为,
所有的这些行为都是和浮点相关的,在某种程度上非常类似于X87 FPU tag word.
关于%mxcsr寄存器各个位所表示的意思在这里不细说,可以查看Intel手册得到详细解释.
可以查看Intel Vol.1 10.2.3.%mxcrs默认值是0x1f80.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>LDMXCSR</td><td>mem-&gt;%mxcsr.32bit</td></tr>
<tr><td>STMXCSR</td><td>%mxcsr-&gt;mem.32bit</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.2.4" class="outline-4">
<h4 id="sec-1.2.4"><span class="section-number-4">1.2.4</span> Saturation &amp; Wraparound </h4>
<div class="outline-text-4" id="text-1.2.4">

<p>在进行整数运算的时候,可能会存在out-of-range的情况,结果不能够被目标数所表示.对于
这种溢出处理有下面3种方式.
</p><ul>
<li>
Wraparound Arithmetic.
</li>
</ul>

<p>回绕模式.比如8个字节表示257的话,那么就是257-256=1.
</p><ul>
<li>
Signed Saturation Arithmetic.
</li>
</ul>

<p>符号位溢出模式.比如8个字节表示257的话,那么会是0x7f=127.
</p><ul>
<li>
Unsigned Saturation Arithmetic.
</li>
</ul>

<p>无符号溢出模式.比如8个字节表示257的话,那么会是0xff=255.
</p>
<p>
对于溢出模式对于一些计算是非常重要的.假设256色的像素如果两个像素相叠加的话,
当然不希望像素值发生回绕.如果溢出的话,通常这个像素保持纯黑或者是纯白.
</p>
</div>

</div>

<div id="outline-container-1.2.5" class="outline-4">
<h4 id="sec-1.2.5"><span class="section-number-4">1.2.5</span> General Purpose Register(GPR) </h4>
<div class="outline-text-4" id="text-1.2.5">

<p>通用寄存器,包括EAX/RAX,EBX/RBX,ECX/RCX等.这些通用寄存器和%mm和%xmm之间的差别是,
%mm和%xmm不能够用来存放地址,也就是说不能够将内存地址存放在%mm和%xmm里面然后进行引用.
</p>
</div>

</div>

<div id="outline-container-1.2.6" class="outline-4">
<h4 id="sec-1.2.6"><span class="section-number-4">1.2.6</span> X87 FPU </h4>
<div class="outline-text-4" id="text-1.2.6">

<p>X87 FPU是浮点运算部件,共有8个寄存器,组织方式是堆栈.通常来说对于SIMD并不需要关心
X87 FPU这个部件.但是因为SIMD使用的%mm寄存器是FPU寄存器的alias,所以我们这里需要了解.
后面我们把X87 FPU都称为FPU.
</p>
<p>
对于FPU会有一个状态,状态包括执行环境和寄存器内容.每个寄存器80bit.在操作%mm寄存器
和执行FPU指令切换之间,我们可能需要保存状态.那么下面就是关于FPU操作状态的指令.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>FSAVE</td><td>保存FPU状态,然后重新初始化FPU.84/108字节</td></tr>
<tr><td>FRSTORE</td><td>FSAVE逆操作.</td></tr>
<tr><td>FXSAVE</td><td>保存FPU状态/%mm寄存器,%xmm寄存器,%mxscr寄存器.512字节.</td></tr>
<tr><td>FXRSTORE</td><td>FXSAVE逆操作.</td></tr>
</tbody>
</table>


<p>
关于如何协调%mm寄存器和FPU寄存器的使用,在%mm寄存器这节有解释.
</p>
</div>

</div>

<div id="outline-container-1.2.7" class="outline-4">
<h4 id="sec-1.2.7"><span class="section-number-4">1.2.7</span> Packed &amp; Scalar Instructions </h4>
<div class="outline-text-4" id="text-1.2.7">

<p>对于SIMD提供了操作packed和scalar指令.我们假设存在两个操作数,
假设是(f00,f01,f02,f03)和(f10,f11,f12,f13)的话,那么
</p><ul>
<li>
如果是packed操作的话,那么操作是(f00 op f01,f01 op f11,f02 op f12,f03 op f13).
</li>
<li>
如果是scalar操作的话,那么操作是(f00,f01,f03,f03 op f13).
</li>
</ul>

<p>也就是说,如果在scalar操作的话,仅仅是操作最后面一个单元,其他单元全部复制.
</p>
<p>
需要注意的是,在Scalar操作下面
</p><ul>
<li>
单精度浮点是24-bit significand + 8-bit exponent.
</li>
<li>
双精度浮点是53-bit significand + 11-bit exponent.
</li>
</ul>

<p>而在IEEE-754和FPU操作环境下面的的话
</p><ul>
<li>
单精度浮点是24-bit significand + 15-bit exponent.
</li>
<li>
双精度浮点是52-bit significand + 15-bit exponent.
</li>
</ul>

<p>此外SIMD操作浮点数和FPU操作浮点数有些不同,SIMD是直接操作浮点数的Native Format,
而FPU是首先在更高的精度上面操作,然后取舍到Native Format.
</p>
</div>

</div>

<div id="outline-container-1.2.8" class="outline-4">
<h4 id="sec-1.2.8"><span class="section-number-4">1.2.8</span> Temporal &amp; NonTemporal Data </h4>
<div class="outline-text-4" id="text-1.2.8">

<p>待续.需要阅读Intel Vol.3A Memory &amp; Cache Control这节.在Intel Vol.1 10.4.6.2也有介绍.
</p>
</div>

</div>

<div id="outline-container-1.2.9" class="outline-4">
<h4 id="sec-1.2.9"><span class="section-number-4">1.2.9</span> Alignment </h4>
<div class="outline-text-4" id="text-1.2.9">

<p>关于对齐方面,如果使用128bit Memory Operand必须进行16字节的对齐.但是有些例外
</p><ul>
<li>
使用UnAlign的Data Transfer操作,比如MOVUPS/MOVUPD.
</li>
<li>
如果是Scalar Memory Float的话,必须是4字节对齐.
</li>
<li>
如果是Scalar Memory Double的话,必须是8字节对齐.
</li>
<li>
此外还有部分指令字节对齐存在例外,会在响应的指令部分说明.

</li>
</ul>
</div>

</div>

<div id="outline-container-1.2.10" class="outline-4">
<h4 id="sec-1.2.10"><span class="section-number-4">1.2.10</span> Asymmetric &amp; Horizontal Processing </h4>
<div class="outline-text-4" id="text-1.2.10">

<p>分别是对称处理和水平处理.假设存在操作数(a0,a1,a2,a3)以及(b0,b1,b2,b3).
对于大部分SIMD指令处理都是对称处理,也就是(a0 op b0,a1 op b1,a2 op b2,a3 op b3).
相邻处理就是(a0 op a1,a2 op a3,b0 op b1,b2 op b3).
</p>
</div>

</div>

<div id="outline-container-1.2.11" class="outline-4">
<h4 id="sec-1.2.11"><span class="section-number-4">1.2.11</span> Zero Fill &amp; Truncated </h4>
<div class="outline-text-4" id="text-1.2.11">

<p>对于从内存/寄存器载入到寄存器的话,如果位数不够,通常是占用寄存器的低字节,
除非显式指定.对于寄存器中没有使用的高字节,通常是采用0填充,也就是Zero Fill.:).
</p>
<p>
而另外一个方面,如果从寄存器传输到内存/寄存器,如果寄存器位数过多的话,那么也
通常只是传输寄存器的低字节,而保留寄存器的高字节,也就是Truncated.:).
</p>
</div>
</div>

</div>

<div id="outline-container-1.3" class="outline-3">
<h3 id="sec-1.3"><span class="section-number-3">1.3</span> 指令 </h3>
<div class="outline-text-3" id="text-1.3">

<p>为了方便表示,我们定义下面缩写和操作.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">助记符</th><th scope="col">含义</th><th scope="col">其他</th></tr>
</thead>
<tbody>
<tr><td>A</td><td>Aligned</td><td></td></tr>
<tr><td>U</td><td>UnAligned</td><td></td></tr>
<tr><td>L</td><td>Low</td><td></td></tr>
<tr><td>H</td><td>High/Horizontal</td><td></td></tr>
<tr><td>B</td><td>Byte</td><td></td></tr>
<tr><td>SB</td><td>Signed Byte</td><td></td></tr>
<tr><td>UB</td><td>Unsigned Byte</td><td></td></tr>
<tr><td>W</td><td>Word</td><td></td></tr>
<tr><td>SW</td><td>Signed Word</td><td></td></tr>
<tr><td>UW</td><td>Unsigned Word</td><td></td></tr>
<tr><td>Q</td><td>Quad Word</td><td></td></tr>
<tr><td>DQ</td><td>Double Quad Word</td><td></td></tr>
<tr><td>F</td><td>Float</td><td></td></tr>
<tr><td>D</td><td>Double</td><td></td></tr>
<tr><td>PS</td><td>Packed Single Precision Floating Point</td><td></td></tr>
<tr><td>SS</td><td>Scalar Single Precision Floating Point</td><td></td></tr>
<tr><td>PD</td><td>Packed Double Precision Floating Point</td><td></td></tr>
<tr><td>SD</td><td>Scalar Double Precision Floating Point</td><td></td></tr>
<tr><td>CMP</td><td>Compare</td><td></td></tr>
<tr><td>STR</td><td>String</td><td></td></tr>
<tr><td>EQ</td><td>Equal</td><td></td></tr>
<tr><td>GT</td><td>Greater</td><td></td></tr>
<tr><td>SLL</td><td>Shift Left Logical</td><td></td></tr>
<tr><td>SRL</td><td>Shift Right Logical</td><td></td></tr>
<tr><td>SRA</td><td>Shift Right Arithmetic</td><td></td></tr>
<tr><td>DUP</td><td>Duplicate</td><td></td></tr>
<tr><td>WAM</td><td>Wraparound Mode</td><td></td></tr>
<tr><td>SSM</td><td>Signed Saturation Mode</td><td></td></tr>
<tr><td>USM</td><td>Unsigned Saturation Mode</td><td></td></tr>
<tr><td>RCP</td><td>Reciprocal.RCP(x)=1/x</td><td></td></tr>
<tr><td>SQRT</td><td>Square Root</td><td></td></tr>
<tr><td>RSQRT</td><td>Reciprocal Square Root</td><td></td></tr>
<tr><td>MSK</td><td>Mask</td><td></td></tr>
<tr><td>CVT</td><td>Convert</td><td></td></tr>
<tr><td>SX</td><td>Signed Extend</td><td></td></tr>
<tr><td>ZX</td><td>Zero Extend</td><td></td></tr>
<tr><td>ROUND</td><td></td><td></td></tr>
<tr><td>UNPCK</td><td>Unpack</td><td></td></tr>
<tr><td>EXTR</td><td>Extract</td><td></td></tr>
<tr><td>INSR</td><td>Insert</td><td></td></tr>
<tr><td>AND</td><td>a &amp;&amp; b</td><td></td></tr>
<tr><td>OR</td><td>a or b</td><td></td></tr>
<tr><td>NAND</td><td>!(a &amp;&amp; b)</td><td></td></tr>
<tr><td>XOR</td><td>a ^ b</td><td></td></tr>
<tr><td>SAD</td><td>Sum of Absolute Difference.</td><td></td></tr>
<tr><td>SIGN</td><td>SIGN(src,dst)=if(src&lt;0):dst=-dst</td><td></td></tr>
<tr><td>MADD</td><td>MADD((a00,a01),(b00,b01))=(a00*b00)+(a01*b01)</td><td></td></tr>
<tr><td>ALIGNR</td><td>ALIGNR(src,dst,imm)=(src,dst) &gt;&gt; imm</td><td></td></tr>
<tr><td>AVG</td><td>Average</td><td></td></tr>
<tr><td>ABS</td><td>Absolute</td><td></td></tr>
<tr><td>NT</td><td>NonTemporal</td><td></td></tr>
<tr><td>CVTT</td><td>Convert With Truncate</td><td></td></tr>
<tr><td>UNPCKH</td><td>UNPCKH((s00,s01),(d00,d01))=(d01,s01)</td><td></td></tr>
<tr><td>UNPCKL</td><td>UNPCKL((s00,s01),(d00,d01))=(d00,s00)</td><td></td></tr>
<tr><td>MSB</td><td>Most Significant Bit</td><td></td></tr>
<tr><td>LF</td><td>Lowest Float</td><td></td></tr>
<tr><td>LF2</td><td>Lower 2 Floats</td><td></td></tr>
<tr><td>LF4</td><td>Lower 4 Floats</td><td></td></tr>
<tr><td>HF</td><td>Highest Float</td><td></td></tr>
<tr><td>HF2</td><td>Higher 2 Floats</td><td></td></tr>
<tr><td>LD</td><td>Lowest Double</td><td></td></tr>
<tr><td>HD</td><td>Highest Double</td><td></td></tr>
<tr><td>LDW</td><td>Lower Double Word</td><td></td></tr>
<tr><td>LDW2</td><td>Lower 2 Double Words</td><td></td></tr>
<tr><td>LDW4</td><td>Lower 4 Double Words</td><td></td></tr>
<tr><td>LW</td><td>Lower Word</td><td></td></tr>
<tr><td>HW</td><td>Higher Wword</td><td></td></tr>
<tr><td>GPR</td><td>General Purpose Resgister</td><td></td></tr>
</tbody>
</table>


<p>
这里有几点需要注意的
</p><ul>
<li>
对于Move如果使用了错误类型指令的话,会产生性能消耗.Vol.1 11.6.9
</li>
<li>
对于使用SIMD来说,推荐使用caller-save.Vol.1 11.6.10.3

</li>
</ul>

</div>

<div id="outline-container-1.3.1" class="outline-4">
<h4 id="sec-1.3.1"><span class="section-number-4">1.3.1</span> Data Transfer Instructions </h4>
<div class="outline-text-4" id="text-1.3.1">


</div>

<div id="outline-container-1.3.1.1" class="outline-5">
<h5 id="sec-1.3.1.1"><span class="section-number-5">1.3.1.1</span> Move Mask Instructions </h5>
<div class="outline-text-5" id="text-1.3.1.1">

<p>对于每一个data element的MSB移到GRP.这些指令通常用于分支判定.
</p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>PMOVMSKB</td><td></td></tr>
<tr><td>MOVMSKPS</td><td></td></tr>
<tr><td>MOVMSKPD</td><td></td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.3.1.2" class="outline-5">
<h5 id="sec-1.3.1.2"><span class="section-number-5">1.3.1.2</span> Move Integer Instructions </h5>
<div class="outline-text-5" id="text-1.3.1.2">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>MOVD</td><td></td></tr>
<tr><td>MOVQ</td><td></td></tr>
<tr><td>MOVDQA</td><td></td></tr>
<tr><td>MOVDQU</td><td></td></tr>
<tr><td>LDDQU</td><td>功能和MOVDQU相同</td></tr>
</tbody>
</table>


<p>
关于LDDQU和MOVDQU的差别,可以参看Intel关于LDDQU指令描述,主要还是在某些场景
下面的性能差别,功能上没有任何区别.
</p>
</div>

</div>

<div id="outline-container-1.3.1.3" class="outline-5">
<h5 id="sec-1.3.1.3"><span class="section-number-5">1.3.1.3</span> Move Float Instructions </h5>
<div class="outline-text-5" id="text-1.3.1.3">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>MOVAPS</td><td></td></tr>
<tr><td>MOVUPS</td><td></td></tr>
<tr><td>MOVSS</td><td></td></tr>
<tr><td>MOVLPS</td><td>2PS&lt;-&gt;LF2(%xmm)</td></tr>
<tr><td>MOVHPS</td><td>2PS&lt;-&gt;HF2(%xmm)</td></tr>
<tr><td>MOVLHPS</td><td>LF2(%xmm1)-&gt;HF2(%xmm2)</td></tr>
<tr><td>MOVHLPS</td><td>HF2(%xmm1)-&gt;LF2(%xmm1)</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.3.1.4" class="outline-5">
<h5 id="sec-1.3.1.4"><span class="section-number-5">1.3.1.4</span> Move Double Instructions </h5>
<div class="outline-text-5" id="text-1.3.1.4">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>MOVAPD</td><td></td></tr>
<tr><td>MOVUPD</td><td></td></tr>
<tr><td>MOVSD</td><td></td></tr>
<tr><td>MOVLPD</td><td>PD&lt;-&gt;LD(%xmm)</td></tr>
<tr><td>MOVHPD</td><td>PD&lt;-&gt;HD(%xmm)</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.3.1.5" class="outline-5">
<h5 id="sec-1.3.1.5"><span class="section-number-5">1.3.1.5</span> Move Duplication Instructions </h5>
<div class="outline-text-5" id="text-1.3.1.5">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>MOVDDUP</td><td>(d0,d1)-&gt;(d0,d0)</td></tr>
<tr><td>MOVSHDUP</td><td>(f0,f1,f2,f3)-&gt;(f1,f1,f3,f3)</td></tr>
<tr><td>MOVSLDUP</td><td>(f0,f1,f2,f3)-&gt;(f0,f0,f2,f2)</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.3.1.6" class="outline-5">
<h5 id="sec-1.3.1.6"><span class="section-number-5">1.3.1.6</span> Move NonTemporal Instructions </h5>
<div class="outline-text-5" id="text-1.3.1.6">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>MOVNTI</td><td></td></tr>
<tr><td>MOVNTQ</td><td></td></tr>
<tr><td>MOVNTDQ</td><td></td></tr>
<tr><td>MOVNTDQA</td><td></td></tr>
<tr><td>MOVNTPS</td><td></td></tr>
<tr><td>MOVNTPD</td><td></td></tr>
<tr><td>MASKMOVQ</td><td>@@TODO</td></tr>
<tr><td>MASKMOVDQU</td><td>@@TODO</td></tr>
</tbody>
</table>


</div>
</div>

</div>

<div id="outline-container-1.3.2" class="outline-4">
<h4 id="sec-1.3.2"><span class="section-number-4">1.3.2</span> Arithmetic Instructions </h4>
<div class="outline-text-4" id="text-1.3.2">


</div>

<div id="outline-container-1.3.2.1" class="outline-5">
<h5 id="sec-1.3.2.1"><span class="section-number-5">1.3.2.1</span> ADD Instructions </h5>
<div class="outline-text-5" id="text-1.3.2.1">

<ul>
<li id="sec-1.3.2.1.1">对称处理 <br/>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>PADDB</td><td>WAM</td></tr>
<tr><td>PADDW</td><td>WAM</td></tr>
<tr><td>PADDD</td><td>WAM</td></tr>
<tr><td>PADDQ</td><td>WAM</td></tr>
<tr><td>PADDSB</td><td>SSM</td></tr>
<tr><td>PADDSW</td><td>SSM</td></tr>
<tr><td>PADDUSB</td><td>USM</td></tr>
<tr><td>PADDUSW</td><td>USM</td></tr>
<tr><td>ADDPS</td><td></td></tr>
<tr><td>ADDSS</td><td></td></tr>
<tr><td>ADDPD</td><td></td></tr>
<tr><td>ADDSD</td><td></td></tr>
</tbody>
</table>


</li>
<li id="sec-1.3.2.1.2">水平处理 <br/>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>PHADDW</td><td></td></tr>
<tr><td>PHADDSW</td><td>SSM</td></tr>
<tr><td>PHADDD</td><td></td></tr>
<tr><td>HADDPS</td><td></td></tr>
<tr><td>HADDPD</td><td></td></tr>
</tbody>
</table>


</li>
</ul>
</div>

</div>

<div id="outline-container-1.3.2.2" class="outline-5">
<h5 id="sec-1.3.2.2"><span class="section-number-5">1.3.2.2</span> SUB Instructions </h5>
<div class="outline-text-5" id="text-1.3.2.2">

<ul>
<li id="sec-1.3.2.2.1">对称处理 <br/>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>PSUBB</td><td>WAM</td></tr>
<tr><td>PSUBW</td><td>WAM</td></tr>
<tr><td>PSUBD</td><td>WAM</td></tr>
<tr><td>PSUBQ</td><td>WAM</td></tr>
<tr><td>PSUBSB</td><td>SSM</td></tr>
<tr><td>PSUBSW</td><td>SSM</td></tr>
<tr><td>PSUBSD</td><td>SSM</td></tr>
<tr><td>PSUBUSB</td><td>USM</td></tr>
<tr><td>PSUBUSW</td><td>USM</td></tr>
<tr><td>SUBPS</td><td></td></tr>
<tr><td>SUBSS</td><td></td></tr>
<tr><td>SUBPD</td><td></td></tr>
<tr><td>SUBSD</td><td></td></tr>
</tbody>
</table>


</li>
<li id="sec-1.3.2.2.2">水平处理 <br/>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>PHSUBW</td><td></td></tr>
<tr><td>PHSUBSW</td><td>SSM</td></tr>
<tr><td>PHSUBD</td><td></td></tr>
<tr><td>HSUBPS</td><td></td></tr>
<tr><td>HSUBPD</td><td></td></tr>
</tbody>
</table>


</li>
</ul>
</div>

</div>

<div id="outline-container-1.3.2.3" class="outline-5">
<h5 id="sec-1.3.2.3"><span class="section-number-5">1.3.2.3</span> MUL Instructions </h5>
<div class="outline-text-5" id="text-1.3.2.3">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>PMULLW</td><td>(w00,w01,..),(w10,w11,..)-&gt;(LW(w00*w10),LW(w01*w11),..)</td></tr>
<tr><td>PMULHW</td><td>(w00,w01,..),(w10,w11,..)-&gt;(HW(w00*w10),HW(w01*w11),..)</td></tr>
<tr><td>PMULHUW</td><td>同上,Unsigned方式.</td></tr>
<tr><td>PMULLD</td><td>(dw00,dw01,..),(dw10,dw11,..)-&gt;(LDW(dw00*dw10),LDW(dw01*dw11),..)</td></tr>
<tr><td>PMULDQ</td><td>(dw00,dw01,..),(dw10,dw11,..)-&gt;(dw00*dw10,dw01*dw11,..)</td></tr>
<tr><td>PMULUDQ</td><td>同上,Unsigned方式.</td></tr>
<tr><td>MULPS</td><td></td></tr>
<tr><td>MULSS</td><td></td></tr>
<tr><td>MULPD</td><td></td></tr>
<tr><td>MULSD</td><td></td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.3.2.4" class="outline-5">
<h5 id="sec-1.3.2.4"><span class="section-number-5">1.3.2.4</span> DIV Instructions </h5>
<div class="outline-text-5" id="text-1.3.2.4">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>DIVPS</td><td></td></tr>
<tr><td>DIVSS</td><td></td></tr>
<tr><td>DIVPD</td><td></td></tr>
<tr><td>DIVSD</td><td></td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.3.2.5" class="outline-5">
<h5 id="sec-1.3.2.5"><span class="section-number-5">1.3.2.5</span> M?X Instructions </h5>
<div class="outline-text-5" id="text-1.3.2.5">

<ul>
<li id="sec-1.3.2.5.1">MAX <br/>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>PMAXSB</td><td></td></tr>
<tr><td>PMAXSW</td><td></td></tr>
<tr><td>PMAXSD</td><td></td></tr>
<tr><td>PMAXUB</td><td></td></tr>
<tr><td>PMAXUW</td><td></td></tr>
<tr><td>PMAXUD</td><td></td></tr>
<tr><td>MAXPS</td><td></td></tr>
<tr><td>MAXSS</td><td></td></tr>
<tr><td>MAXPD</td><td></td></tr>
<tr><td>MAXSD</td><td></td></tr>
</tbody>
</table>


</li>
<li id="sec-1.3.2.5.2">MIN <br/>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>PMINSB</td><td></td></tr>
<tr><td>PMINSW</td><td></td></tr>
<tr><td>PMINSD</td><td></td></tr>
<tr><td>PMINUB</td><td></td></tr>
<tr><td>PMINUW</td><td></td></tr>
<tr><td>PMINUD</td><td></td></tr>
<tr><td>MINPS</td><td></td></tr>
<tr><td>MINSS</td><td></td></tr>
<tr><td>MINPD</td><td></td></tr>
<tr><td>MINSD</td><td></td></tr>
<tr><td>PHMINPOSUW</td><td></td></tr>
</tbody>
</table>


<p>
PHMINPOSUW可以按照Unsigned Word来水平搜索最小值的位置.
</p>
</li>
</ul>
</div>

</div>

<div id="outline-container-1.3.2.6" class="outline-5">
<h5 id="sec-1.3.2.6"><span class="section-number-5">1.3.2.6</span> Math Instructions </h5>
<div class="outline-text-5" id="text-1.3.2.6">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>PABSB</td><td></td></tr>
<tr><td>PABSW</td><td></td></tr>
<tr><td>PABSD</td><td></td></tr>
<tr><td>PAVGB</td><td></td></tr>
<tr><td>PAVGW</td><td></td></tr>
<tr><td>PSIGNB</td><td></td></tr>
<tr><td>PSIGNW</td><td></td></tr>
<tr><td>PSIGND</td><td></td></tr>
<tr><td>PMADDUBSW</td><td>UB-&gt;W.SSM</td></tr>
<tr><td>PMADDWD</td><td>W-&gt;DW</td></tr>
<tr><td>PALIGNR</td><td></td></tr>
<tr><td>PMULHRSW</td><td>@@TODO</td></tr>
<tr><td>PSADBW</td><td></td></tr>
<tr><td>MPSADBW</td><td>@@TODO</td></tr>
<tr><td>DPPS</td><td></td></tr>
<tr><td>DPPD</td><td></td></tr>
<tr><td>ADDSUBPS</td><td>(f00,f01,..),(f10,f11,..)-&gt;(f00-f10,f01+f11,..)</td></tr>
<tr><td>ADDSUBPD</td><td>(d00,d01,..),(d10,d11,..)-&gt;(d00-d10,d01+d11,..)</td></tr>
<tr><td>RCPPS</td><td></td></tr>
<tr><td>RCPSS</td><td></td></tr>
<tr><td>RSQRTPS</td><td></td></tr>
<tr><td>RSQRTSS</td><td></td></tr>
<tr><td>SQRTPS</td><td></td></tr>
<tr><td>SQRTSS</td><td></td></tr>
<tr><td>SQRTSD</td><td></td></tr>
</tbody>
</table>


</div>
</div>

</div>

<div id="outline-container-1.3.3" class="outline-4">
<h4 id="sec-1.3.3"><span class="section-number-4">1.3.3</span> Comparison Instructions </h4>
<div class="outline-text-4" id="text-1.3.3">

<p>需要注意的是,如果没有特殊说明,比较结果是直接存放在结果数里面的,
不会影响EFLAGS这个寄存器内容.如果比较结果影响了EFLAGS寄存器的话,
那么会使用%EFLAGS来标记.
</p>
<p>
如果每个比较结果是符合预期的话,
那么目的数对应位数会置0xff,否则会置0x0.
</p>
<p>
对于CMP的指令,会使用立即数来决定具体使用什么比较方式.关于立即数对应
什么比较方式,可以查看具体指令里面的说明,比如CMPPS,CMPSS,CMPPD,CMPSD.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>PCMPEQB</td><td></td></tr>
<tr><td>PCMPEQW</td><td></td></tr>
<tr><td>PCMPEQD</td><td></td></tr>
<tr><td>PCMPEQQ</td><td></td></tr>
<tr><td>PCMPGTB</td><td></td></tr>
<tr><td>PCMPGTW</td><td></td></tr>
<tr><td>PCMPGTD</td><td></td></tr>
<tr><td>PCMPGTQ</td><td></td></tr>
<tr><td>CMPPS</td><td></td></tr>
<tr><td>CMPSS</td><td></td></tr>
<tr><td>CMPPD</td><td></td></tr>
<tr><td>CMPSD</td><td></td></tr>
<tr><td>COMISS</td><td>%EFLAGS</td></tr>
<tr><td>UCOMISS</td><td>%EFLAGS</td></tr>
<tr><td>COMISD</td><td>%EFLAGS</td></tr>
<tr><td>UCOMISD</td><td>%EFLAGS</td></tr>
<tr><td>PTEST</td><td></td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.3.4" class="outline-4">
<h4 id="sec-1.3.4"><span class="section-number-4">1.3.4</span> Conversion Instructions </h4>
<div class="outline-text-4" id="text-1.3.4">

<p>对于涉及到浮点数的精度取舍问题,使用%mxccsr寄存器来判断.
</p>
<p>
如果精度取舍是采用截断方式来进行处理的话,那么指令前缀通常是CVTT.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>PACKSSWB</td><td>SSM</td></tr>
<tr><td>PACKSSDW</td><td>SSM</td></tr>
<tr><td>PACKUSDW</td><td>USM</td></tr>
</tbody>
</table>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>CVTPS2PD</td><td></td></tr>
<tr><td>CVTPD2PS</td><td></td></tr>
<tr><td>CVTSS2SD</td><td></td></tr>
<tr><td>CVTSD2SS</td><td></td></tr>
<tr><td>CVTPI2PS</td><td></td></tr>
<tr><td>CVTPS2PI</td><td></td></tr>
<tr><td>CVTTPS2PI</td><td></td></tr>
<tr><td>CVTSI2SS</td><td></td></tr>
<tr><td>CVTSS2SI</td><td></td></tr>
<tr><td>CVTTSS2SI</td><td></td></tr>
<tr><td>CVTPI2PD</td><td></td></tr>
<tr><td>CVTPD2PI</td><td></td></tr>
<tr><td>CVTTPD2PI</td><td></td></tr>
<tr><td>CVTSI2SD</td><td></td></tr>
<tr><td>CVTSD2SI</td><td></td></tr>
<tr><td>CVTTSD2SI</td><td></td></tr>
<tr><td>CVTDQ2PS</td><td></td></tr>
<tr><td>CVTPS2DQ</td><td></td></tr>
<tr><td>CVTTPS2DQ</td><td></td></tr>
<tr><td>CVTDQ2PD</td><td></td></tr>
<tr><td>CVTPD2DQ</td><td></td></tr>
<tr><td>CVTTPD2DQ</td><td></td></tr>
</tbody>
</table>



<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>MOVQ2DQ</td><td></td></tr>
<tr><td>MOVDQ2Q</td><td></td></tr>
<tr><td>PMOVSXBW</td><td></td></tr>
<tr><td>PMOVZXBW</td><td></td></tr>
<tr><td>PMOVSXBD</td><td></td></tr>
<tr><td>PMOVZXBD</td><td></td></tr>
<tr><td>PMOVSXWD</td><td></td></tr>
<tr><td>PMOVZXWD</td><td></td></tr>
<tr><td>PMOVSXBQ</td><td></td></tr>
<tr><td>PMOVZXBQ</td><td></td></tr>
<tr><td>PMOVSXWQ</td><td></td></tr>
<tr><td>PMOVZXWQ</td><td></td></tr>
<tr><td>PMOVSXDQ</td><td></td></tr>
<tr><td>PMOVZXDQ</td><td></td></tr>
</tbody>
</table>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>ROUNDPS</td><td></td></tr>
<tr><td>ROUNDPD</td><td></td></tr>
<tr><td>ROUNDSS</td><td></td></tr>
<tr><td>ROUNDSD</td><td></td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.3.5" class="outline-4">
<h4 id="sec-1.3.5"><span class="section-number-4">1.3.5</span> Insert &amp; Unpack Instructions </h4>
<div class="outline-text-4" id="text-1.3.5">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>PUNPCKHBW</td><td></td></tr>
<tr><td>PUNPCKHWD</td><td></td></tr>
<tr><td>PUNPCKHDQ</td><td></td></tr>
<tr><td>PUNPCKHQDQ</td><td></td></tr>
<tr><td>PUNPCKLBW</td><td></td></tr>
<tr><td>PUNPCKLWD</td><td></td></tr>
<tr><td>PUNPCKLDQ</td><td></td></tr>
<tr><td>PUNPCKLQDQ</td><td></td></tr>
<tr><td>UNPCKHPS</td><td></td></tr>
<tr><td>UNPCKLPS</td><td></td></tr>
<tr><td>UNPCKHPD</td><td></td></tr>
<tr><td>UNPCKLPD</td><td></td></tr>
</tbody>
</table>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>PEXTRB</td><td></td></tr>
<tr><td>PEXTRW</td><td></td></tr>
<tr><td>PEXTRD</td><td></td></tr>
<tr><td>PEXTRQ</td><td></td></tr>
<tr><td>PINSRB</td><td></td></tr>
<tr><td>PINSRW</td><td></td></tr>
<tr><td>PINSRD</td><td></td></tr>
<tr><td>PINSRQ</td><td></td></tr>
<tr><td>EXTRACTPS</td><td>-&gt;GPR</td></tr>
<tr><td>INSERTPS</td><td></td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.3.6" class="outline-4">
<h4 id="sec-1.3.6"><span class="section-number-4">1.3.6</span> Logical Instructions </h4>
<div class="outline-text-4" id="text-1.3.6">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>PAND</td><td></td></tr>
<tr><td>PANDN</td><td></td></tr>
<tr><td>POR</td><td></td></tr>
<tr><td>PXOR</td><td></td></tr>
<tr><td>ANDPS</td><td></td></tr>
<tr><td>ANDNPS</td><td></td></tr>
<tr><td>ORPS</td><td></td></tr>
<tr><td>XORPS</td><td></td></tr>
<tr><td>ANDPD</td><td></td></tr>
<tr><td>ANDNPD</td><td></td></tr>
<tr><td>ORPD</td><td></td></tr>
<tr><td>XORPD</td><td></td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.3.7" class="outline-4">
<h4 id="sec-1.3.7"><span class="section-number-4">1.3.7</span> Shift Instructions </h4>
<div class="outline-text-4" id="text-1.3.7">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>PSLLW</td><td></td></tr>
<tr><td>PSLLD</td><td></td></tr>
<tr><td>PSLLQ</td><td></td></tr>
<tr><td>PSLLDQ</td><td></td></tr>
<tr><td>PSRLW</td><td></td></tr>
<tr><td>PSRLD</td><td></td></tr>
<tr><td>PSRLQ</td><td></td></tr>
<tr><td>PSRLDQ</td><td></td></tr>
<tr><td>PSRAW</td><td></td></tr>
<tr><td>PSRAD</td><td></td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.3.8" class="outline-4">
<h4 id="sec-1.3.8"><span class="section-number-4">1.3.8</span> Shuffle Instructions </h4>
<div class="outline-text-4" id="text-1.3.8">

<p>SHUF操作根据imm来决定,dst每个位置的element应该是由
src的哪个位置的element来进行填充的.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>PSHUFB</td><td></td></tr>
<tr><td>PSHUFW</td><td></td></tr>
<tr><td>PSHUFLW</td><td></td></tr>
<tr><td>PSHUFHW</td><td></td></tr>
<tr><td>PSHUFD</td><td></td></tr>
<tr><td>SHUFPS</td><td></td></tr>
<tr><td>SHUFPD</td><td></td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.3.9" class="outline-4">
<h4 id="sec-1.3.9"><span class="section-number-4">1.3.9</span> Blending Instructions </h4>
<div class="outline-text-4" id="text-1.3.9">

<p>BLEND操作是根据imm来决定,dst每个位置的element应该是从src里面对应位置取出,
还是应该从dst里面对应位置取出.
</p>
<p>
BLENDV操作和BLEND操作过程一样的,不同的是由%xmm0来决定的而不是由imm来决定.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>BLENDPS</td><td></td></tr>
<tr><td>BLENDPD</td><td></td></tr>
<tr><td>BLENDVPS</td><td></td></tr>
<tr><td>BLENDVPD</td><td></td></tr>
<tr><td>PBLENDVB</td><td></td></tr>
<tr><td>PBLENDW</td><td></td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.3.10" class="outline-4">
<h4 id="sec-1.3.10"><span class="section-number-4">1.3.10</span> String Instructions </h4>
<div class="outline-text-4" id="text-1.3.10">

<ul>
<li>
内存操作数不要求字节对齐.
</li>
<li>
CMPE/I的E表示explicit显式指定长度,I表示implicit隐式指定长度.
</li>
<li>
STRI/STRM的I表示结果是Index,M表示结果是Mask.

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">指令</th><th scope="col">说明</th></tr>
</thead>
<tbody>
<tr><td>PCMPESTRI</td><td></td></tr>
<tr><td>PCMPESTRM</td><td></td></tr>
<tr><td>PCMPISTRI</td><td></td></tr>
<tr><td>PCMPISTRM</td><td></td></tr>
</tbody>
</table>


</li>
</ul>
</div>

</div>

<div id="outline-container-1.3.11" class="outline-4">
<h4 id="sec-1.3.11"><span class="section-number-4">1.3.11</span> MISC Instructions </h4>
<div class="outline-text-4" id="text-1.3.11">


</div>

<div id="outline-container-1.3.11.1" class="outline-5">
<h5 id="sec-1.3.11.1"><span class="section-number-5">1.3.11.1</span> Cache Control Instructions </h5>
<div class="outline-text-5" id="text-1.3.11.1">

<ul>
<li>
CLFLUSH
</li>
</ul>

<p>CLFLUSH是cache line flush,能够将某个内存地址的cache line全部失效.
</p>
</div>

</div>

<div id="outline-container-1.3.11.2" class="outline-5">
<h5 id="sec-1.3.11.2"><span class="section-number-5">1.3.11.2</span> Prefetch Instructions </h5>
<div class="outline-text-5" id="text-1.3.11.2">

<p>对于预取指令的话不会影响程序行为,通常来说会预取32个对齐的字节,但是具体
还是依赖于实现.对于NT数据的话,依然会尽可能地减少Cache的污染.
</p>
<ul>
<li>
PREFETCH0
</li>
</ul>

<p>预取到所有Cache层次.
</p><ul>
<li>
PREFETCH1
</li>
</ul>

<p>预取到1级缓存.
</p><ul>
<li>
PREFETCH2
</li>
</ul>

<p>预取到2级缓存.
</p><ul>
<li>
PREFETCHNTA
</li>
</ul>

<p>???
</p>
</div>

</div>

<div id="outline-container-1.3.11.3" class="outline-5">
<h5 id="sec-1.3.11.3"><span class="section-number-5">1.3.11.3</span> Memory Ordering Instructions </h5>
<div class="outline-text-5" id="text-1.3.11.3">

<ul>
<li>
SFENCE
</li>
</ul>

<p>在SFENCE之前的Store操作,从全局视图来看,一定在SFENCE之后的Store操作之前完成.
</p><ul>
<li>
LFENCE
</li>
</ul>

<p>在LFENCE之前的Load操作,从全局视图来看,一定在LFENCE之后的Load操作之前完成.
</p><ul>
<li>
MFENCE
</li>
</ul>

<p>MFENCE结合了SFENCE和LFENCE两个功能.
</p>
</div>

</div>

<div id="outline-container-1.3.11.4" class="outline-5">
<h5 id="sec-1.3.11.4"><span class="section-number-5">1.3.11.4</span> X87 FPU Instructions </h5>
<div class="outline-text-5" id="text-1.3.11.4">

<ul>
<li>
FISTTP
</li>
</ul>

<p>这条指令非常类似FISTP,是将FPU TOS的浮点数转换成为整数,精度处理使用截断.
FISTP需要修改FPU Tag Word设置为截断处理才会有这样的效果,
</p>
</div>

</div>

<div id="outline-container-1.3.11.5" class="outline-5">
<h5 id="sec-1.3.11.5"><span class="section-number-5">1.3.11.5</span> Thread Sync Instructions </h5>
<div class="outline-text-5" id="text-1.3.11.5">

<p>需要注意的是,这些指令都只能够在ring0级别下面运行,对于&lt;ring0的界别是可选运行的.
</p><ul>
<li>
MONITOR
</li>
</ul>

<p>设置一块地址区域来监视是否存在write-back-stores的操作.
</p><ul>
<li>
MWAIT
</li>
</ul>

<p>等待某块地址区域发生write-back-stores.这块地址区域必须经过MONITOR设置.在等待
这块地址区域写入的时候Logical Processor能够进入optimized state.
</p>
</div>

</div>

<div id="outline-container-1.3.11.6" class="outline-5">
<h5 id="sec-1.3.11.6"><span class="section-number-5">1.3.11.6</span> 其他 </h5>
<div class="outline-text-5" id="text-1.3.11.6">

<ul>
<li>
PAUSE
</li>
</ul>

<p>PAUSE指令能够显著改善自旋锁的循环等待期间的性能,同时减少机器的耗能.
</p><ul>
<li>
Branch Hints
</li>
</ul>

<p>对于Jcc这样的指令,允许在之前加上2EH,3EH作为Prefix能够进行预取提示.
这个没有特别的助记符,只是在生成的机器代码二进制上略有不同.
</p><ul>
<li>
CRC32
</li>
</ul>

<p>CRC32算法的有效实现.
</p><ul>
<li>
POPCNT
</li>
</ul>

<p>计算操作数的bit表示中存在多少个1.
</p></div>
</div>
</div>
</div>
</div>
<div id="postamble">
<p class="date"> Date: 2013-10-14 12:18:21 CST</p>
<p class="creator">HTML generated by org-mode 6.33x in emacs 23</p>
</div>
</div>
<!-- Baidu Analytics BEGIN --><script type="text/javascript">var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F54a700ad7035f6e485eaf2300641e7e9' type='text/javascript'%3E%3C/script%3E"));</script><!-- Baidu Analytics END --><!-- Google Analytics BEGIN --><script type="text/javascript">  var _gaq = _gaq || [];  _gaq.push(['_setAccount', 'UA-31377772-1']);  _gaq.push(['_trackPageview']);  (function() {    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);  })();</script><!-- Google Analytics END --><!-- Baidu Button BEGIN --><!-- <script type="text/javascript" id="bdshare_js" data="type=tools&amp;uid=6762177" ></script><script type="text/javascript" id="bdshell_js"></script><script type="text/javascript"> document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000)</script> --><!-- Baidu Button END --><!-- G+ BEGIN --><!-- Place this render call where appropriate --><script type="text/javascript">  (function() {    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;    po.src = 'https://apis.google.com/js/plusone.js';    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);  })();</script><!-- G+ END --><!-- DISQUS BEGIN --><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * *//* required: replace example with your forum shortname  */var disqus_shortname = 'dirlt';var disqus_identifier = 'simd.html';var disqus_title = 'simd.html';var disqus_url = 'http://dirlt.com/simd.html';/* * * DON'T EDIT BELOW THIS LINE * * */(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a><!-- DISQUS END --></body>
</html>
